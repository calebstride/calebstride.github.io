<!DOCTYPE html><html lang="en"><head>
    <script type="text/javascript" src="/scripts/ContentTools.js"></script>
    <script type="text/javascript">
        window.addEventListener('load', () => { ContentTools.findAndSetSelectedFromStorage(); });
    </script>
    
    <title>Snake (KMP) | Caleb Stride</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <meta name="description" content="A page containing the summary of creating a simple snake game in Kotlin Multiplatform">
    <meta name="author" content="Caleb Stride">

    <link href="/styles/main.css" rel="stylesheet" type="text/css">
    <link href="/styles/hljs.css" rel="stylesheet" type="text/css">

    <link rel="icon" href="/images/favicon.svg" sizes="any" type="image/svg+xml">
    <link rel="icon" href="/images/favicon-48x48.png" sizes="48x48" type="image/png">
    <link rel="icon" href="/images/favicon-32x32.png" sizes="32x32" type="image/png">

    <script>
         ContentTools.initTheme();
    </script>
</head>

<body>

    <div id="page-container">

        <div class="page-buffer" id="left-buffer"></div>

        <nav id="side-bar" class="hidden-feature-mob"><ul id="main-nav-bar"><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Home') === 'true'){event.stopPropagation();}" href="/index.html">Home</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('About') === 'true'){event.stopPropagation();}" href="/about.html">About</a></div></li><li><div class="drop-down-button menu-button" id="Projectsdrop-down-b" onclick="ContentTools.hideOrShowNavBar(this, 'Projects-drop-down')"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Projects') === 'true'){event.stopPropagation();}" href="/projects.html">Projects</a></div><ul class="drop-down-content selected-drop-down" id="Projects-drop-down"><li><div class="drop-down-button menu-button" id="Manage Cabbagedrop-down-b" onclick="ContentTools.hideOrShowNavBar(this, 'Manage Cabbage-drop-down')"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Manage Cabbage') === 'true'){event.stopPropagation();}" href="/projects/manageCabbage.html">Manage Cabbage</a></div><ul class="drop-down-content selected-drop-down" id="Manage Cabbage-drop-down"><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Previous Design') === 'true'){event.stopPropagation();}" href="/projects/manageCabbage/previousDesign.html">Previous Design</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Designing') === 'true'){event.stopPropagation();}" href="/projects/manageCabbage/design.html">Designing</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('App') === 'true'){event.stopPropagation();}" href="/projects/manageCabbage/app.html">App</a></div></li></ul></li><li class="selected"><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Snake (KMP)') === 'true'){event.stopPropagation();}" href="/projects/snake.html">Snake (KMP)</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Website Generator') === 'true'){event.stopPropagation();}" href="/projects/websiteGenerator.html">Website Generator</a></div></li></ul></li><li><div class="drop-down-button menu-button" id="Blogdrop-down-b" onclick="ContentTools.hideOrShowNavBar(this, 'Blog-drop-down')"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Blog') === 'true'){event.stopPropagation();}" href="/blog.html">Blog</a></div><ul class="drop-down-content selected-drop-down" id="Blog-drop-down"><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Java Multithreading Revision') === 'true'){event.stopPropagation();}" href="/blog/javaThreading.html">Java Multithreading Revision</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Java Collections Analysis') === 'true'){event.stopPropagation();}" href="/blog/javaCollections.html">Java Collections Analysis</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Screenshots in Android Tests') === 'true'){event.stopPropagation();}" href="/blog/screenshotDuringTest.html">Screenshots in Android Tests</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Jetpack Compose Progress Bar') === 'true'){event.stopPropagation();}" href="/blog/loadingBar.html">Jetpack Compose Progress Bar</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Android Vico Point Colours') === 'true'){event.stopPropagation();}" href="/blog/vicoPoints.html">Android Vico Point Colours</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Webpage Colour Themes') === 'true'){event.stopPropagation();}" href="/blog/themes.html">Webpage Colour Themes</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('React Router OpenID') === 'true'){event.stopPropagation();}" href="/blog/openIdUi.html">React Router OpenID</a></div></li></ul></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Contact') === 'true'){event.stopPropagation();}" href="/contact.html">Contact</a></div></li></ul>
            <div id="theme-wrap">
                <button class="theme-button hidden-feature-mob" onclick="ContentTools.changeTheme()">Toggle Theme</button>
            </div>
        </nav>

        <div id="page-content">
            <div id="dynamic-content">
                <h1 id="page-title">Snake (Kotlin Multiplatform)</h1>
                <div id="page-text"><h2 id="Summary">Summary</h2>
<p>I started this project to practice using the <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/get-started.html">Kotlin Multiplatform Development technology</a>.
The idea of this technology is to you can create your app in Kotlin, then compile it to
run on different environments. This allows you to reuse code across different platforms.</p>
<p>For example, you can code most of the logic in Kotlin, and then compile this to both 
Android and IOS platforms. This is similar to how React Native and Flutter work.</p>
<div id="doc-menu-area"> <div><a href="#Summary" class="header-row-h2 doc-menu-link"> 
            Summary </a><a href="#Plan" class="header-row-h2 doc-menu-link"> 
            Plan </a><a href="#GettingStarted" class="header-row-h2 doc-menu-link"> 
            Getting Started </a><a href="#RunningonPlatforms" class="header-row-h3 doc-menu-link"> 
            Running on Platforms </a><a href="#RenderingtheGame" class="header-row-h2 doc-menu-link"> 
            Rendering the Game </a><a href="#ImplementSnakeLogic" class="header-row-h2 doc-menu-link"> 
            Implement Snake Logic </a><a href="#Example" class="header-row-h2 doc-menu-link"> 
            Example </a><a href="#Conclusion" class="header-row-h2 doc-menu-link"> 
            Conclusion </a></div></div>

<h2 id="Plan">Plan</h2>
<p>The aim of this is to test the Kotlin Multiplatform technology rather than produce a
complex or new app. For this reason I will be implementing a simple <a href="https://en.wikipedia.org/wiki/Snake_(video_game_genre)">Snake game</a>.</p>
<p>This doesn't need any planning and the ui will just contain the controls for moving the 
snake. Those being up, down, left and right.</p>
<h2 id="GettingStarted">Getting Started</h2>
<p>To start I followed <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/compose-multiplatform-getting-started.html">this guide on creating a multiplatform project</a> 
in Android Studio.</p>
<p>Using <a href="https://kmp.jetbrains.com/">the wizard</a> I created a template that would work on
Android, IOS, Desktop and Web.</p>
<h3 id="RunningonPlatforms">Running on Platforms</h3>
<p>After importing and building from the Gradle files I could then run the simple app bundled
with the starter code. Running on the Android device was simple and works the same way
with existing Android compose development.</p>
<p>I don't have the IOS runtimes installed, so I skipped that and ran the app on the 
desktop runtime. Doing this was really easy, and just required running the gradle command.</p>
<pre><code class="hljs language-bash">./gradlew desktopRun -DmainClass=MainKt --quiet
</code></pre><p>This uses your installed Java JVM to run the application. So doesn't require any difficult
setup.</p>
<p>Running the browser version was also really easy and only needed the command:</p>
<pre><code class="hljs language-bash">./gradlew wasmJsBrowserRun -t --quiet
</code></pre><p>You can then view the app in the browser. The main platform the browser version targets is
<a href="https://webassembly.org/">Wasm (Web Assembly)</a> instead of the normal JS runtime.</p>
<h2 id="RenderingtheGame">Rendering the Game</h2>
<p>To render the snake game I'll be using Compose, primarily utilising the Box element to
create a grid, using different colours for the snake, food and background. This isn't the
most efficient way, but it'll do for this game.</p>
<p>Since Compose works by detecting the changes in state then I can create some
state that holds the snake positions. By updating these positions compose can render
the updated snake to the screen.</p>
<p>A space will be left at the bottom of the screen to hold the buttons that control the snake.</p>
<h2 id="ImplementSnakeLogic">Implement Snake Logic</h2>
<p>The game will run on a grid where each position in the grid is either a snake, food or
empty. The snake can move to an empty space, food but if it hits itself the game is over.
If the snake reaches some food the size of the snake is increased.</p>
<p>Since the game will be tied closely to the ui I will utilise state objects to update control
the ui. I'll start with a class called SnakeGameState that
will store the config and overall game state, like the score, food and snake position. I 
will then store an array that contains the CellState of each cell.</p>
<p>The user then can control the Snake which will change the direction. Every unit of 
time the snake will move one space in that direction. If the head reaches a food then
the length will increase and another food will be placed on the board. If it reaches 
another part of the snake the game is over.</p>
<p>You can <a href="https://github.com/calebstride/snake-kmp">view the code on the GitHub repo</a>.</p>
<p>An example piece of code is the <a href="https://github.com/calebstride/snake-kmp/blob/main/composeApp/src/commonMain/kotlin/com/calebstride/snake/game/SnakeGameState.kt">tick() method in SnakeGameState</a> 
that's run every given milliseconds. This is the controlled by the main game 
loop from the ui.</p>
<pre><code class="hljs language-kotlin"><span class="hljs-comment">// Within the ui the main game loop is run when the page is rendered</span>
LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {
        snakeGameState.tick()
    }
}

<span class="hljs-comment">/**
 * Called every time we want to update the game. If the game isn't in a RUNNING state then
 * nothing is updated.
 */</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">tick</span><span class="hljs-params">()</span></span> {
    delay(delay)
    <span class="hljs-keyword">if</span> (_gameState.value != GameState.RUNNING) <span class="hljs-keyword">return</span>
    <span class="hljs-comment">// Figure out the space we're going to move to</span>
    <span class="hljs-keyword">val</span> nextIndex = getNextIndex(snakeIndices.first(), direction)
    <span class="hljs-keyword">val</span> cellType = cellStates[nextIndex].cellType.value
    <span class="hljs-keyword">when</span>(cellType) {
        <span class="hljs-comment">// Add the snake head to this position but don't shrink the snake, also create new food</span>
        CellType.FOOD -&gt; {
            snakeIndices.addFirst(nextIndex)
            updateCellType(nextIndex, CellType.SNAKE)
            createNewFood()
            increaseScore()
        }
        <span class="hljs-comment">// Add the snake head to this position and move the last snake position</span>
        CellType.EMPTY -&gt; {
            updateCellType(snakeIndices.removeLast(), CellType.EMPTY)
            snakeIndices.addFirst(nextIndex)
            updateCellType(nextIndex, CellType.SNAKE)
        }
        <span class="hljs-comment">// We've hit the snake so game over</span>
        CellType.SNAKE -&gt; {
            _gameState.value = GameState.GAME_OVER
        }
    }
}
</code></pre><h2 id="Example">Example</h2>
<p>Since I used KMP I can generate this Kotlin code into JS/Wasm. To do that I used
the guide on <a href="https://kotlinlang.org/docs/wasm-get-started.html#generate-artifacts">generating the artifacts</a>. </p>
<p>This mainly just meant running the below command and manually changing some references to 
files, as they expect you to run the app from the website root.</p>
<pre><code class="hljs language-bash">./gradlew wasmJsBrowserDistribution
</code></pre><p>I could then upload the js files and reference it in this page. See below for the snake game.</p>
<script type="application/javascript" src="/scripts/snake/composeApp.js"></script>
<div class="compose-app-wrapper">
    <div id="composeApplication" style="width:400px; height: 440px;"></div>
</div>

<h2 id="Conclusion">Conclusion</h2>
<p>I'm pretty happy with the game. It works as expected and is the first game I've actually
ever created apart from simple text games.</p>
<p>It also shows the benefit of Kotlin / Compose Multiplatform. This took me a day and 
a half to code and create, which isn't too quick for a simple game such as this. But 
considering I can now build this to run on IOS, Android, Browsers (via Wasm) and on the 
JVM (which means almost all modern OSs) which shows how beneficial a technology 
like this can be when distributing to multiple platforms.</p>
<p>In terms of using KMP I can see that if you had a complex codebase the project would be
pretty difficult to maintain and build. But thanks to being able to share code it 
would still reduce the overall work and resources needed compared to having separate 
teams for each platform.</p>
<p>In the future I would like to migrate my <a href="manageCabbage/app.html">finance management application</a> 
to use KMP. The problem with this is the reliance on Java apis and libraries for 
the Android application. I would need to extract these into platform specific code using
the <a href="https://kotlinlang.org/docs/multiplatform-expect-actual.html">expect and actual keywords</a> 
or adopt multiplatform dependencies.</p>
</div>
            </div>
        </div>

        <div id="page-right-hand"> </div>
        <div class="page-buffer" id="right-buffer"></div>
    </div>

    <div id="burger-hug">
        <div id="theme-wrap-mob" class="hidden-feature-mob hidden-feature-big">
            <button class="theme-button" onclick="ContentTools.changeTheme()">Toggle Theme</button>
        </div>
        <div id="b-menu" class="hidden-feature-big" onclick="ContentTools.hideOrShowList(['side-bar', 'close-container', 'b-menu', 'theme-wrap-mob'], true);">
            <div class="b-men"></div>
            <div class="b-men"></div>
            <div class="b-men"></div>
        </div>
        <div id="close-container" class="hidden-feature-big hidden-feature-mob" onclick="ContentTools.hideOrShowList(['side-bar', 'close-container', 'b-menu', 'theme-wrap-mob'], true);">
            ×
        </div>
    </div>

</body></html>