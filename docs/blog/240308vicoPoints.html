<!DOCTYPE html><html lang="en"><head>
    <script type="text/javascript" src="/scripts/ContentTools.js"></script>
    <script type="text/javascript">
        window.addEventListener('load', () => { ContentTools.findAndSetSelectedFromStorage(); });
    </script>
    
    <title>Android Vico Point Colours | Caleb Stride</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <meta name="description" content="A guide on how to change the colour of a point in a vico chart depending on where the point is located">
    <meta name="author" content="Caleb Stride">

    <link href="/styles/main.css" rel="stylesheet" type="text/css">
    <link href="/styles/hljs.css" rel="stylesheet" type="text/css">

    <script>
         ContentTools.initTheme();
    </script>
</head>

<body>

    <div id="page-container">

        <div class="page-buffer" id="left-buffer"></div>

        <nav id="side-bar" class="hidden-feature-mob"><ul id="main-nav-bar"><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Home') === 'true'){event.stopPropagation();}" href="/index.html">Home</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('About') === 'true'){event.stopPropagation();}" href="/about.html">About</a></div></li><li><div class="drop-down-button menu-button" id="Projectsdrop-down-b" onclick="ContentTools.hideOrShowNavBar(this, 'Projects-drop-down')"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Projects') === 'true'){event.stopPropagation();}" href="/projects.html">Projects</a></div><ul class="drop-down-content selected-drop-down" id="Projects-drop-down"><li><div class="drop-down-button menu-button" id="Manage Cabbagedrop-down-b" onclick="ContentTools.hideOrShowNavBar(this, 'Manage Cabbage-drop-down')"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Manage Cabbage') === 'true'){event.stopPropagation();}" href="/projects/manageCabbage.html">Manage Cabbage</a></div><ul class="drop-down-content selected-drop-down" id="Manage Cabbage-drop-down"><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Previous Design') === 'true'){event.stopPropagation();}" href="/projects/manageCabbage/previousDesign.html">Previous Design</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Designing') === 'true'){event.stopPropagation();}" href="/projects/manageCabbage/design.html">Designing</a></div></li></ul></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Website Generator') === 'true'){event.stopPropagation();}" href="/projects/websiteGenerator.html">Website Generator</a></div></li></ul></li><li><div class="drop-down-button menu-button" id="Blogdrop-down-b" onclick="ContentTools.hideOrShowNavBar(this, 'Blog-drop-down')"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Blog') === 'true'){event.stopPropagation();}" href="/blog.html">Blog</a></div><ul class="drop-down-content selected-drop-down" id="Blog-drop-down"><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('React Router OpenID') === 'true'){event.stopPropagation();}" href="/blog/231022openIdUi.html">React Router OpenID</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Webpage Colour Themes') === 'true'){event.stopPropagation();}" href="/blog/231116themes.html">Webpage Colour Themes</a></div></li><li class="selected"><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Android Vico Point Colours') === 'true'){event.stopPropagation();}" href="/blog/240308vicoPoints.html">Android Vico Point Colours</a></div></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Jetpack Compose Progress Bar') === 'true'){event.stopPropagation();}" href="/blog/240406loadingBar.html">Jetpack Compose Progress Bar</a></div></li></ul></li><li><div class="menu-button"><div class="drop-down-icon"></div><a onclick="if(window.sessionStorage.getItem('Contact') === 'true'){event.stopPropagation();}" href="/contact.html">Contact</a></div></li></ul>
            <div id="theme-wrap">
                <button class="theme-button hidden-feature-mob" onclick="ContentTools.changeTheme()">Toggle Theme</button>
            </div>
        </nav>

        <div id="page-content">
            <div id="dynamic-content">
                <h1 id="page-title">Android Vico Point Colours</h1>
                <div id="page-text"><h3 id="Problem">Problem</h3>
<p>Whilst working on an android app I started using a great chart library called <a href="https://github.com/patrykandpatrick/vico">vico</a>. 
This library is very extensible and has great documentation as well as some good examples.</p>
<p>For one of the graphs I was creating I wanted to place a point on the graph as a circle. See below for an example graph
before and after the points:</p>
<p><img src="/images/vico/chartNoPoints.png" width="400" alt="Chart with no points"><br><img src="/images/vico/chartWrongPoints.png" width="400" alt="Chart with wrong points"></p>
<p>This issue with this is that the points don't obey the colour of the line.</p>
<h3 id="Solution">Solution</h3>
<h4 id="CreatingANewComponent">Creating A New Component</h4>
<p>To fix this I looked at the class that was used to define the point. This class implements 
the com.patrykandpatrick.vico.core.component.Component class. I then started implement a 
child of this class that would be able to change the point colour based on the position 
of the point.</p>
<p>The draw method was the only one I needed to implement, and it was defined as the following:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">draw</span><span class="hljs-params">(
    context: <span class="hljs-type">DrawContext</span>,
    left: <span class="hljs-type">Float</span>,
    top: <span class="hljs-type">Float</span>,
    right: <span class="hljs-type">Float</span>,
    bottom: <span class="hljs-type">Float</span>,
    opacity: <span class="hljs-type">Float</span>
)</span></span> {
    <span class="hljs-comment">//TODO</span>
}
</code></pre><p>The left, top, right and bottom values are the positions in the canvas rather than the 
position in x,y space. Luckily the context provided the minimum and maximum y and x values
of the chart.</p>
<h4 id="DeterminingIfAboveZero">Determining If Above Zero</h4>
<p>Unfortunately, the x and y ranges would not provide us with the current position of the 
point being drawn. To get this we need the position of the axis relative to the canvas.</p>
<p>The ChartDrawContext has this data in the chartBounds field. So we can only do this
when the context is type ChartDrawContext, which it was within graphs from my testing.</p>
<p>With the chart ranges given in the canvas position and the x,y ranges we could translate
the position of the point (in canvas space) into a position in x,y space. We then can 
look at the y value to determine if it's above zero.</p>
<p>Here is a method that does this.</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isBelowZero</span><span class="hljs-params">(context: <span class="hljs-type">ChartDrawContext</span>, canvasYPos: <span class="hljs-type">Float</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">val</span> yRange = context.chartValues.getYRange(AxisPosition.Vertical.End)
    <span class="hljs-keyword">if</span> (yRange.minY &gt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-comment">// All values above 0</span>
    <span class="hljs-keyword">if</span> (yRange.maxY &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// All values below 0</span>
    
    <span class="hljs-keyword">val</span> yZeroRatio = -yRange.minY / (yRange.maxY - yRange.minY) <span class="hljs-comment">// Ratio of y=0 along y axis</span>
    <span class="hljs-keyword">val</span> bounds = context.chartBounds
    <span class="hljs-keyword">val</span> canvasBottomOfChart = maxOf(bounds.bottom, bounds.top) <span class="hljs-comment">// The top and bottom are no guaranteed to be sorted</span>
    <span class="hljs-keyword">val</span> canvasYZeroPos = canvasBottomOfChart - (yZeroRatio * bounds.height()) <span class="hljs-comment">// As (0,0) is top left we need take away to make our way up the y axis</span>
    <span class="hljs-keyword">return</span> canvasYPos &gt; canvasYZeroPos
}
</code></pre><p>To start this method we get the yRange object from the context. Then if the minimum Y
value is above 0 we know all the points are positive. The opposite is true when the 
maximum Y is below 0.</p>
<p>We then calculate the ratio that y = 0 is between the minimum and maximum y values. Then
using this ratio we can calculate how far along the canvas 0 is. In the canvas the (0,0)
position is the top left, hence why we subtract the value.</p>
<p>Finally, we can check if the canvasYPos of the current point is above the canvas Y position
of 0.</p>
<h4 id="RenderDifferentColours">Render Different Colours</h4>
<p>To make the colours of the points different I just added two different shape components
with different colours in my class. Depending on if the value is negative or positive
a different shape component is used.</p>
<h3 id="Conclusion">Conclusion</h3>
<p>The final class is at the bottom of this page. After implementing it and setting the
point value in the LineSpec to our new class the result is the following.</p>
<img src="/images/vico/chartFixedPoints.png" width="400" alt="Chart with wrong points">

<p>So now the points reflect the shader of the LineSpec.</p>
<p>I haven't currently seen any issues with this. Although I think that there's potential
for something to go wrong when using zooming. This class could be extended further
to allow for different point shapes or styles depending on their position.</p>
<pre><code class="hljs language-kotlin"><span class="hljs-comment">/**
 * A shape component that uses a different shape components depending on the position 
 * the point is drawn
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ShapeComponentAdaptable</span>(
    shape: Shape = Shapes.pillShape,
    colourTop: <span class="hljs-built_in">Int</span>,
    colourBottom: <span class="hljs-built_in">Int</span>,
) : Component() {

    <span class="hljs-comment">// Shape component for y&gt;0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> shapeComponentTop = ShapeComponent(shape = shape, color = colourTop) 

    <span class="hljs-comment">// Shape component for y&lt;0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> shapeComponentBottom =  ShapeComponent(shape = shape, color = colourBottom) 

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">draw</span><span class="hljs-params">(
        context: <span class="hljs-type">DrawContext</span>,
        left: <span class="hljs-type">Float</span>,
        top: <span class="hljs-type">Float</span>,
        right: <span class="hljs-type">Float</span>,
        bottom: <span class="hljs-type">Float</span>,
        opacity: <span class="hljs-type">Float</span>
    )</span></span> {
        <span class="hljs-keyword">val</span> yPosition = (top + bottom) / <span class="hljs-number">2</span> <span class="hljs-comment">// Get the middle y position of the point</span>
        <span class="hljs-comment">// Default to one shape if the context isn't the correct class</span>
        <span class="hljs-keyword">if</span> (context <span class="hljs-keyword">is</span> ChartDrawContext &amp;&amp; !isBelowZero(context = context, canvasYPos = yPosition)) {
            shapeComponentTop.draw(context, left, top, right, bottom, opacity)
        } <span class="hljs-keyword">else</span> {
            shapeComponentBottom.draw(context, left, top, right, bottom, opacity)
        }
    }

    <span class="hljs-comment">/**
     * Find where the zero Y position is on the canvas, then check if the [canvasYPos] value is below
     * that
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isBelowZero</span><span class="hljs-params">(context: <span class="hljs-type">ChartDrawContext</span>, canvasYPos: <span class="hljs-type">Float</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">val</span> yRange = context.chartValues.getYRange(AxisPosition.Vertical.End)
        <span class="hljs-keyword">if</span> (yRange.minY &gt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> <span class="hljs-comment">// All values above 0</span>
        <span class="hljs-keyword">if</span> (yRange.maxY &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// All values below 0</span>
        
        <span class="hljs-keyword">val</span> yZeroRatio = -yRange.minY / (yRange.maxY - yRange.minY) <span class="hljs-comment">// Ratio of y=0 along y axis</span>
        <span class="hljs-keyword">val</span> bounds = context.chartBounds
        <span class="hljs-keyword">val</span> canvasBottomOfChart = maxOf(bounds.bottom, bounds.top) <span class="hljs-comment">// The top and bottom are no guaranteed to be sorted</span>
        <span class="hljs-keyword">val</span> canvasYZeroPos = canvasBottomOfChart - (yZeroRatio * bounds.height()) <span class="hljs-comment">// As (0,0) is top left we need take away to make our way up the y axis</span>
        <span class="hljs-keyword">return</span> canvasYPos &gt; canvasYZeroPos
    }
}
</code></pre></div>
            </div>
        </div>

        <div id="page-right-hand"> </div>
        <div class="page-buffer" id="right-buffer"></div>
    </div>

    <div id="burger-hug">
        <div id="theme-wrap-mob" class="hidden-feature-mob hidden-feature-big">
            <button class="theme-button" onclick="ContentTools.changeTheme()">Toggle Theme</button>
        </div>
        <div id="b-menu" class="hidden-feature-big" onclick="ContentTools.hideOrShowList(['side-bar', 'close-container', 'b-menu', 'theme-wrap-mob'], true);">
            <div class="b-men"></div>
            <div class="b-men"></div>
            <div class="b-men"></div>
        </div>
        <div id="close-container" class="hidden-feature-big hidden-feature-mob" onclick="ContentTools.hideOrShowList(['side-bar', 'close-container', 'b-menu', 'theme-wrap-mob'], true);">
            ×
        </div>
    </div>

</body></html>